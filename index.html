<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Vereins Check-in</title>

<style>
body{
  font-family: Arial;
  text-align:center;
  margin:20px;
}

/* breiter Container */
.card{
  width:95%;
  max-width:1000px;
  margin:auto;
  border:1px solid #ccc;
  border-radius:10px;
  padding:30px;
}

/* Suchfeld */
input{
  font-size:22px;
  padding:12px;
  width:90%;
}

/* Buttons */
button{
  font-size:26px;
  padding:15px 25px;
  margin:8px;
  cursor:pointer;
}

/* Statusfarben */
.ok{
  color:green;
  font-weight:bold;
  font-size:22px;
}

.warn{
  color:red;
  font-weight:bold;
  font-size:22px;
}

hr{
  margin:30px;
}
</style>
</head>

<body>

<div class="card">

<h2>Mitglied suchen (Name oder ID)</h2>
<input type="text" id="search" placeholder="Name oder Nummer eingeben"
       oninput="findPerson()">
<div id="results"></div>

<hr>

<h1 id="name" style="font-size:42px;">QR scannen oder suchen</h1>
<p id="dept" style="font-size:24px;"></p>

<button onclick="checkin()">Einchecken</button>
<p id="msg"></p>

</div>

<script>

// â­â­â­ HIER DEINE APPS SCRIPT URL EINTRAGEN â­â­â­
const API = "https://script.google.com/macros/s/AKfycbxWeCpYf2luG88HC0TsdZiikDfYTBoUhYZZ6KvloMUq0kTReA-GHA49Th3BpRA7g1tWIQ/exec";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

// Wenn per QR geÃ¶ffnet â†’ Daten laden
if(id){
  fetch(API + "?id=" + id)
    .then(r => r.json())
    .then(data => {
      document.getElementById("name").innerText = data.name;
      document.getElementById("dept").innerText = data.dept;
    })
    .catch(() => {
      document.getElementById("name").innerText = "Nicht gefunden";
    });
}

function checkin(){
  if(!id){
    alert("Bitte erst Person auswÃ¤hlen");
    return;
  }

  fetch(API + "?checkin=1&id=" + id)
    .then(r => r.text())
    .then(msg => {
      const el = document.getElementById("msg");
      el.innerText = msg;
      el.className = (msg === "OK") ? "ok" : "warn";
    });
}

// ðŸ”Ž Suche nach Name oder ID
function findPerson(){
  const q = document.getElementById("search").value;

  if(q.length < 1){
    document.getElementById("results").innerHTML = "";
    return;
  }

  fetch(API + "?search=" + q)
    .then(r => r.json())
    .then(list => {
      const div = document.getElementById("results");
      div.innerHTML = "";

      list.forEach(p => {
        const btn = document.createElement("button");
        btn.innerText = p.name + " (" + p.dept + ") - ID " + p.id;
        btn.style.display = "block";
        btn.style.margin = "8px auto";
        btn.onclick = () => {
          window.location.search = "?id=" + p.id;
        };
        div.appendChild(btn);
      });
    });
}
</script>

</body>
</html>
