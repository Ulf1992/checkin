<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Vereins Check-in</title>

<style>
body{
  font-family: Arial;
  text-align:center;
  margin:20px;
}
.card{
  max-width:500px;
  margin:auto;
  border:1px solid #ccc;
  border-radius:10px;
  padding:20px;
}
input{
  font-size:18px;
  padding:10px;
  width:90%;
}
button{
  font-size:20px;
  padding:12px 20px;
  margin:5px;
}
.ok{color:green;}
.warn{color:red;}
hr{margin:25px;}
</style>
</head>

<body>

<div class="card">

<h3>Mitglied suchen (Name oder ID)</h3>
<input type="text" id="search" placeholder="Name oder Nummer"
       oninput="findPerson()">
<div id="results"></div>

<hr>

<h2 id="name">QR scannen oder suchen</h2>
<p id="dept"></p>

<button onclick="checkin()">Einchecken</button>
<p id="msg"></p>

</div>

<script>

// â­â­â­ HIER DEINE URL EINTRAGEN â­â­â­
const API = "HIER_DEINE_APPS_SCRIPT_URL";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

// Wenn per QR geÃ¶ffnet â†’ Daten laden
if(id){
  fetch(API + "?id=" + id)
    .then(r => r.json())
    .then(data => {
      document.getElementById("name").innerText = data.name;
      document.getElementById("dept").innerText = data.dept;
    })
    .catch(() => {
      document.getElementById("name").innerText = "Nicht gefunden";
    });
}

function checkin(){
  if(!id){
    alert("Bitte erst Person auswÃ¤hlen");
    return;
  }

  fetch(API + "?checkin=1&id=" + id)
    .then(r => r.text())
    .then(msg => {
      const el = document.getElementById("msg");
      el.innerText = msg;
      el.className = (msg === "OK") ? "ok" : "warn";
    });
}

// ðŸ”Ž Suche
function findPerson(){
  const q = document.getElementById("search").value;

  if(q.length < 1){
    document.getElementById("results").innerHTML = "";
    return;
  }

  fetch(API + "?search=" + q)
    .then(r => r.json())
    .then(list => {
      const div = document.getElementById("results");
      div.innerHTML = "";

      list.forEach(p => {
        const btn = document.createElement("button");
        btn.innerText = p.name + " (" + p.dept + ") - ID " + p.id;
        btn.style.display = "block";
        btn.onclick = () => {
          window.location.search = "?id=" + p.id;
        };
        div.appendChild(btn);
      });
    });
}
</script>

</body>
</html>
